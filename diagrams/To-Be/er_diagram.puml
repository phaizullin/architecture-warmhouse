@startuml "Теплый дом - Entity Relationship Diagram"

entity "User (Пользователь)" as User {
  *id : UUID <<PK>>
  --
  *email : VARCHAR(255)
  *password_hash : VARCHAR(255)
  first_name : VARCHAR(100)
  last_name : VARCHAR(100)
  *status : ENUM
}

entity "House (Дом)" as House {
  *id : UUID <<PK>>
  --
  *owner_id : UUID <<FK>>
  *name : VARCHAR(100)
  address : VARCHAR(255)
  area : DECIMAL
}

entity "Room (Комната)" as Room {
  *id : UUID <<PK>>
  --
  *house_id : UUID <<FK>>
  *name : VARCHAR(100)
  *type : ENUM
  area : DECIMAL
}

entity "DeviceType (Тип устройства)" as DeviceType {
  *id : UUID <<PK>>
  --
  *name : VARCHAR(100)
  *category : ENUM
  protocol : VARCHAR(50)
}

entity "Device (Устройство)" as Device {
  *id : UUID <<PK>>
  --
  *house_id : UUID <<FK>>
  room_id : UUID <<FK>>
  *device_type_id : UUID <<FK>>
  *name : VARCHAR(100)
  *serial_number : VARCHAR(100) <<UQ>>
  *status : ENUM
}

entity "Module (Модуль)" as Module {
  *id : UUID <<PK>>
  --
  *name : VARCHAR(100)
  *type : ENUM
  version : VARCHAR(50)
  *status : ENUM
}

entity "TelemetryData (Телеметрия)" as TelemetryData {
  *id : UUID <<PK>>
  --
  *device_id : UUID <<FK>>
  *timestamp : TIMESTAMP
  *data_type : VARCHAR(50)
  *value : DECIMAL
  unit : VARCHAR(20)
}

entity "UserHouseAccess (Доступ к дому)" as UserHouseAccess {
  *id : UUID <<PK>>
  --
  *user_id : UUID <<FK>>
  *house_id : UUID <<FK>>
  *access_level : ENUM
}

entity "DeviceModule (Модуль устройства)" as DeviceModule {
  *id : UUID <<PK>>
  --
  *device_id : UUID <<FK>>
  *module_id : UUID <<FK>>
  is_enabled : BOOLEAN
}

User ||--o{ House : "owns"
User }|--|{ House : "has access to"

House ||--o{ Room : "contains"
House ||--o{ Device : "has installed"

Device }o--|| DeviceType : "is of type"
Device ||--o{ TelemetryData : "generates"
Room ||--o{ Device : "contains"
Device }|--|{ Module : "uses"

User }|--|| UserHouseAccess
UserHouseAccess ||--|| House
Device }|--|| DeviceModule
DeviceModule ||--|{ Module

@enduml 